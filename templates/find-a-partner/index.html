{% extends "templates/base_index.html" %}

{% block title %}Find a partner | Ubuntu partners{% endblock %}
{% block meta_description %}Browse current Ubuntu partners in hardware, software, mobile or cloud - or find a specific partner from the list.{% endblock %}
{% block meta_keywords %}Canonical, Ubuntu, partner, partnership, program, programme, carrier, telco, mobile, network, phone, smartphone, tablet, cloud, OpenStack, public cloud, infrastructure, guest, image, server, ISV, software, hardware, enablement, certify, certified, certification, PC, laptop, desktop, reseller, VAR, channel, developer{% endblock %}

{% block content %}
<div class="row row-hero">
    <div class="nine-col">
        <h1>Find an Ubuntu partner</h1>
        <p>Canonical&rsquo;s network of Ubuntu partners spans the full range of technology activities. We offer partner programmes for software vendors, hardware OEMs, mobile carriers, resellers, retailers and public cloud providers. </p>
    </div>
</div>
<div class="row no-border">
    <div class="search-panel three-col">
        <h2>Search</h2>
        <form>
            <input type="text" name="search" id="search">
            <input type="text" name="filter" id="filter" class="accessibility-aid">
        </form>
        <h2>Filter</h2>
        {% for filter in filters %}
          <h3>{{ filter.name }}</h3>
          <ul class="no-bullets">
          {% for item in filter.items %}
          <li>
            <input type="checkbox" name="{{ filter.name|slugify }}-{{ item|slugify }}" id="{{ filter.name|slugify }}-{{ item|slugify }}">
            <label for="f{{ filter.name|slugify }}-{{ item|slugify }}">{{ item }}</label>
          </li>
          {% endfor %}
          </ul>
        {% endfor %}
    </div>
    <div id="results" class="results eight-col last-col">
        {% for p in partners %}
        <div class="partner four-col box last-col" data-searchText="{{ p.name }} {{ p.long_description }}" data-filter="{% for category in p.category.all %}category-{{ category.name|slugify }} {% endfor %}{% for industry_sector in p.industry_sector.all %}industry-sector-{{ industry_sector.name|slugify }} {% endfor %}{% for programme in p.programme.all %}programme-{{ programme.name|slugify }} {% endfor %}{% for service_offered in p.service_offered.all %}service-offered-{{ service_offered.name|slugify }} {% endfor %}{% for region in p.region.all %}region-{{ region.name|slugify }} {% endfor %}" >
            <div class="twelve-col">
                <img src="{{ p.logo }}" width="100" alt="{{ p.name }} logo" />
            </div>
            <h2>{{ p.name }}</h2>
            <p>{{ p.short_description }}</p>
        </div>
        {% endfor %}
    </div>
</div>

{% include "templates/_contextual-footer.html" %}

{% endblock %}

{% block footer_extra %}
<script>
YUI().use('autocomplete-base', 'autocomplete-filters', function (Y) {
  // Create a custom PartnerFilter class that extends AutoCompleteBase.
  var PartnerFilter = Y.Base.create('partnerFilter', Y.Base, [Y.AutoCompleteBase], {
    initializer: function () {
      this._bindUIACBase();
      this._syncUIACBase();
    }
  }),

  // Create instance
  search = new PartnerFilter({
    inputNode: '#search',
    minQueryLength: 0,
    queryDelay: 0,

    // Immediately-invoked function to gather data
    source: (function () {
      var results = [];

      Y.all('#results > .partner').each(function (node) {
        results.push({
          node: node,
          searchText: node.getAttribute('data-searchText')
        });
      });

      return results;
    }()), // <-- Note the parens. This invokes the function immediately.
          //     Remove these to invoke the function on every query instead.

    resultTextLocator: 'searchText',

    // filter on part-words
    resultFilters: 'subWordMatch'
  });

  // Create instance
  filter = new PartnerFilter({
    inputNode: '#filter',
    minQueryLength: 0,
    queryDelay: 0,

    // Immediately-invoked function to gather data
    source: (function () {
      var results = [];

      Y.all('#results > .partner').each(function (node) {
        results.push({
          node: node,
          searchText: node.getAttribute('data-filter')
        });
      });

      return results;
    }()), // <-- Note the parens. This invokes the function immediately.
          //     Remove these to invoke the function on every query instead.

    resultTextLocator: 'searchText',

    // filter on words
    resultFilters: 'wordMatch'
  });

  // Subscribe to the "results" event
  search.on('results', function (e) {
    Y.all('#results > .partner').addClass('notSearchMatch');

    Y.Array.each(e.results, function (result) {
      result.raw.node.removeClass('notSearchMatch');
    });
  });

  // Subscribe to the "results" event
  filter.on('results', function (e) {
    Y.all('#results > .partner').addClass('notFilterMatch');

    Y.Array.each(e.results, function (result) {
      result.raw.node.removeClass('notFilterMatch');
    });
  });


  var filterText = '';
  var filterElement = Y.one('#filter');

  function updateFilter(name, add) {
    name += ' ';
    if (add == true) {
      if (filterText.indexOf(name) == -1) { 
        filterText += name;
      }
    } else {
      filterText = filterText.replace(name, '');
    }
    filterElement.focus();
    filterElement.set('value', filterText);
  }

  //Add the name of checked checkboxes to #filter
  var checkboxes = Y.all('.search-panel input[type=checkbox]');
  checkboxes.on('change', function (e) {
    var checkbox = e.target;
    var checked = checkbox.get('checked');
    var attributeName = checkbox.get('id')
    updateFilter(attributeName, checked);
  });
});
</script>

{% endblock %}